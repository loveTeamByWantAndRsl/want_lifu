<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>表单</title>
    <link rel="stylesheet" href="./lib/layui/css/layui.css">
    <style>
        .layui-form-label{
            width: 100px;
        }
        .layui-input-block {
            margin-left: 130px;
            min-height: 36px
        }
    </style>
</head>
<body class="body">
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>添加礼服</legend>
</fieldset>


<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body" style="padding-top: 40px;">
            <form class="layui-form" id="lifuForm" style="margin: 0 auto;max-width: 460px;padding-top: 40px;">
                <input id="id" name="id" value="-1" hidden>
                <div class="layui-form-item">
                    <label class="layui-form-label">礼服名字</label>
                    <div class="layui-input-block">
                        <input type="text" name="name" id="name"  required  lay-verify="required" autocomplete="off" placeholder="请输入礼服名称" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">礼服详细</label>
                    <div class="layui-input-block">
                        <textarea name="detal" id="detal" cols="30" rows="10"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">商品图片</label>
                    <div class="layui-input-block">
                        <img id="picImg" src="" style="width: 125px;height: 125px">
                        <input type="file" name="pic" id="pic" cols="30" rows="10">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">是否热品</label>
                    <div class="layui-input-block">
                        <select id="hot" name="hot">
                            <option  value="1" >热门</option>
                            <option value="0">普通</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">是否折扣</label>
                    <div class="layui-input-block">
                        <select id="discount" name="discount">
                            <option  value="1" >折扣</option>
                            <option value="0">不打折</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">是否新品</label>
                    <div class="layui-input-block">
                        <select id="isNew" name="isNew">
                            <option  value="1" >新品</option>
                            <option value="0">非新品</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">隶属品牌</label>
                    <div class="layui-input-block">
                        <select id="trademarkId" name="trademarkId">
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">警告数量</label>
                    <div class="layui-input-block">
                        <input type="number" id="warningCount" name="warningCount" value="10">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">真实价格</label>
                    <div class="layui-input-block">
                        <input type="number" id="truePrice" name="truePrice">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">原始价格</label>
                    <div class="layui-input-block">
                        <input type="number" id="originPrice" name="originPrice">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">状态</label>
                    <div class="layui-input-block">
                        <select id="fStatus1" name="status">
                            <option  value="1" >启用</option>
                            <option value="0">冻结</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">礼服类型</label>
                    <div class="layui-input-block">
                        <select id="typeId" name="typeId">
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">大类型</label>
                    <div class="layui-input-block">
                        <select id="canZuPin" name="canZuPin">
                            <option  value="1" >租聘类型</option>
                            <option value="0">定制类型</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">首页轮播展示</label>
                    <div class="layui-input-block">
                        <select id="showInIndex" name="showInIndex">
                            <option  value="0" >不展示在首页轮播</option>
                            <option value="1">展示在首页轮播</option>
                        </select><br>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formStep">
                            &emsp;确认添加
                        </button>
                    </div>
                </div>
            </form>

            <div style="color: #666;margin-top: 30px;margin-bottom: 40px;padding-left: 30px;">
                <h3>说明</h3><br>
                <h4>入款到保险箱</h4>
                <p>如果需要，这里可以放一些关于产品的常见问题说明。</p>
                <br><h4>入款到现金</h4>
                <p>如果需要，这里可以放一些关于产品的常见问题说明。</p>
            </div>
        </div>
    </div>
</div>

<script src="./lib/layui/layui.all.js" charset="utf-8"></script>
<script src="js/jquery.min.js"></script>
<script src="/js/axios.js"></script>
<!--<script src="/admin/plugin/step/step-lay/step.js"></script>-->

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="add">添加</button>
    </div>
</script>
<script>
    $(function () {
        lifuId = getQueryVariable('lifuId');

            layui.use('layedit', function(){
                layedit = layui.layedit;
                layedit.set({
                    uploadImage: {
                        url: '/upload2' //接口url
                        ,type: 'post' //默认post
                    }
                });

                index = layedit.build('detal'); //建立编辑器

            });
        getClassify();
        if(lifuId != -1){
            axios.get('/lifu/get?id='+lifuId).then(function (res) {
                // console.log(res);
                $('#id').val(res.data.data.id);
                $('#name').val(res.data.data.name);
                // console.log(res.data.data);
                // console.log(res.data.data.detal);

                layedit.setContent(index,res.data.data.detal);
                // console.log(detal);
                // $('#detal').html(detal);

                $('#picImg').attr('src',res.data.data.pic);
                $('#hot').val(res.data.data.hot);
                $('#discount').val(res.data.data.discount);
                $('#isNew').val(res.data.data.isNew);
                $('#trademarkId').val(res.data.data.trademarkId);
                $('#warningCount').val(res.data.data.warningCount);
                $('#truePrice').val(res.data.data.truePrice);
                $('#originPrice').val(res.data.data.originPrice);
                $('#trademarkId').val(res.data.data.trademarkId);
                $('#fStatus1').val(res.data.data.status);
                $('#typeId').val(res.data.data.typeId);
                $('#canZuPin').val(res.data.data.canZuPin);
                $('#showInIndex').val(res.data.data.showInIndex);
                // showInIndex
            });
        }


    });


    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(-1);
    }

    // layui.use('form', function(){
    //    getClassify();
    // });

    function getClassify() {
        $.ajax({
            url: "/admin/trademark/getUseful",
            success: function (res) {
                if (res.code == 200) {
                    for (var i = 0; i < res.data.length; i++) {
                        $("#trademarkId").append("<option value=\"" + res.data[i].id + "\">" + res.data[i].name + "</option>");
                    }
                    //重新渲染
                    layui.form.render("select");
                } else {
                    layer.msg(res.message);
                }
            }
        });
        $.ajax({
            url: "/lifutype/getUseful",
            success: function (res) {
                if (res.code == 200) {
                    for (var i = 0; i < res.data.length; i++) {
                        $("#typeId").append("<option value=\"" + res.data[i].id + "\">" + res.data[i].name + "</option>");
                    }
                    //重新渲染
                    layui.form.render("select");
                } else {
                    layer.msg(res.message);
                }
            }
        });
    }


</script>


<script>

    layui.config({
        // base:'plugin/step/step-lay/'
    }).use([ 'form'], function () { //, 'step'
        var $ = layui.$
            , form = layui.form;
            // , step = layui.step;

        // step.render({
        //     elem: '#stepForm',
        //     filter: 'stepForm',
        //     width: '100%', //设置容器宽度
        //     stepWidth: '1400px',
        //     height: '1800px',
        //     stepItems: [{
        //         title: '填写礼服基本信息'
        //     }, {
        //         title: '填写礼服size和数量'
        //     }, {
        //         title: '完成'
        //     }]
        // });


        form.on('submit(formStep)', function (data) {
            // console.log(data);
            // console.log(data.field);
            axios.post ("/admin/lifu/addLifu",{id:data.field.id
                ,name:data.field.name
                ,canZuPin:data.field.canZuPin
                ,discount:data.field.discount
                ,detal:layedit.getContent(index)
                ,hot:data.field.hot
                ,isNew:data.field.isNew
                ,originPrice:data.field.originPrice
                ,pic:$('#picImg').attr('src')
                ,status:data.field.status
                ,trademarkId:data.field.trademarkId
                ,truePrice:data.field.truePrice
                ,typeId:data.field.typeId
                ,warningCount:data.field.warningCount
                ,showInIndex:data.field.showInIndex})
                .then(function(res){

                    if(res.data.code == 200){
                        // console.log("data : "+res.data.data);
                        lifuId = res.data.data;
                        // console.log("lifuId : "+lifuId);
                        window.location.href = 'sku-list.html?lifuId='+lifuId;
                        // step.next('#stepForm');
                    }
                    else{
                        layer.alert(res.data.message);
                    }
            });
            return false;
        });

        // form.on('submit(formStep2)', function (data) {
        //     console.log(data);
        //
        //     step.next('#stepForm');
        //     return false;
        // });
        //
        // $('.pre').click(function () {
        //     step.pre('#stepForm');
        // });
        //
        // $('.next').click(function () {
        //     step.next('#stepForm');
        // });
    })
</script>

<script>

    $('#pic').change(function(e) {
        var _URL = window.URL || window.webkitURL;
        var file, img;
        if ((file = this.files[0])) {
            img = new Image();
            img.onload = function() {
                $('#picImg').attr('src', this.src);
            };
            img.src = _URL.createObjectURL(file);
            var formData = new FormData();
            formData.append("file", file);
            $.ajax({
                url:"/upload",
                type:"POST",
                data:formData,
                processData : false,
                contentType : false,
                dataType : 'json',
                async : false,
                success : function (result) {
                    // console.log(result);
                    if(result.code == 200){
                        $('#picImg').attr('src', result.message);
                        img.src = result.message;
                    }else {
                        alert("error!");
                    }
                }
            });
        }

    });

    // layui.use(['form','layer','jquery'], function(){
    //     var form = layui.form
    //         ,layer = layui.layer
    //         ,$=layui.jquery,
    //         table= layui.table;
    //     //监听提交
    //     form.on('submit(demo1)', function(data){
    //         axios.post("/admin/quickComment/add",{content:data.field.content,status:data.field.status}).then(function(res){
    //             console.log(res.data.code);
    //             if (res.data.code === 200) {
    //                 layer.closeAll('loading');
    //                 layer.load(2);
    //                 layer.msg("添加成功", {icon: 6});
    //                 setTimeout(function(){
    //                     window.parent.location.reload();//修改成功后刷新父界面
    //                 }, 1000);
    //                 //加载层-风格
    //                 // layer.alert("操作成功！");
    //             }else{
    //                 layer.alert(res);
    //                 layer.alert(res.data.message);
    //             }
    //         }).catch(function (error) {
    //             layer.alert('操作失败');
    //         });
    //         return false;
    //     });
    // });
</script>
</body>
</html>